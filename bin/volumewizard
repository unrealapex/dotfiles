#!/bin/sh

bold="\033[1m"
reset="\033[m"
sink=@DEFAULT_AUDIO_SINK@

notify() {
	notify-send \
		--hint=string:x-dunst-stack-tag:wp-vol \
		--hint=string:synchronous:wp-vol \
		"$@"
}

send_notification() {
	volume=$(wpctl get-volume "$sink")
	if echo $volume | grep -q "MUTED"; then
		notify "volume: muted"
	else
		notify "volume: $(echo ${volume} | tr -dc '0-9' | sed 's/^0\{1,2\}//')%"
	fi
}

case $1 in
	up|down)
		# unmute volume
		wpctl set-mute "$sink" 0
		case $1 in
			up)
				wpctl set-volume --limit 1.0 "$sink" 2%+
				;;
			down)
				wpctl set-volume --limit 1.0 "$sink" 2%-
				;;
		esac
		;;
	mute)
		wpctl set-mute "$sink" toggle
		;;
	*)
		printf "%b\n%b\n" "${bold}volumewizard${reset}: volume control wrapper for wpctl" \
		"${bold}Usage${reset}: volumewizard [up|down|mute]" >&2
		;;
esac

send_notification
